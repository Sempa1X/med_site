{% extends 'base/base.html' %}

{% block content %}
<style>
.collapse {
  overflow: auto;
  width: auto;
  height: auto;
  max-height: 50vh;
  max-width: 100%;
}
</style>

<div class="container" id='main'>
    <form id="form" action="/search/search_process" onsubmit="find_user(); return false;">
        <div class="input-group mb-3">
            <input list="patient" placeholder="Поиск пациента" type="search" id="q" class="form-control" aria-describedby="search-button">
            <datalist id="patient">
                {% for i in patients %}
                <option value="{{ i.full_name }}">
                {% endfor %}
            </datalist>
            <button id="search-button" type="submit" class="btn btn-outline-primary">
                <i class="fas fa-search"></i>
            </button>
        </div>
    </form>

    <!-- <div class="card border-info mb-3" id='card'>
        <div class="card-header bg-transparent border-info" id='header'>Header</div>
        <div class="card-body" id='body'>
            <h5 class="card-title" id='title'>Success card title</h5>
            <p class="card-text" id='card_text'>Some quick example text to build on the card title and make up the bulk of the card's content.</p>
        </div>
        <div class="card-footer bg-transparent border-info">
            <div class="row">
                <div class="col">
                    <label for="old_record" class="form-label"><b>Прошедшие записи</b></label>
                    <div class="accordion accordion-flush" id="old_record">
                        <div class="accordion-item">
                            <h2 class="accordion-header" id="1">
                                <button id='old_btn_1' class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#old_text_1" aria-expanded="false" aria-controls="old_text_1">
                                Accordion Item #1
                                </button>
                            </h2>
                            <div id="old_text_1" class="accordion-collapse collapse" >
                                <div class="accordion-body">Это корпус-гармошка первого предмета. Он отображается по умолчанию, пока плагин свертывания не добавит соответствующие классы, которые мы используем для стилизации каждого элемента. Эти классы управляют общим внешним видом, а также отображением и скрытием с помощью переходов CSS. Вы можете изменить все это с помощью пользовательского CSS или переопределить наши переменные по умолчанию. Также стоит отметить, что практически любой HTML может быть в пределах .accordion-body, хотя переход ограничивает переполнение.</div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col">
                    <label for="future_record" class="form-label"><b>Текущие записи</b></label>
                    <div class="accordion accordion-flush" id="future_record">
                        <div class="accordion-item">
                            <h2 class="accordion-header" id="flush-headingOne">
                                <button id='future_btn_1' class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#future_text_1" aria-expanded="false" aria-controls="future_text_1">
                                    Accordion Item #1
                                </button>
                            </h2>
                            <div id="future_text_1" class="accordion-collapse collapse" >
                                <div class="accordion-body">Это корпус-гармошка первого предмета. Он отображается по умолчанию, пока плагин свертывания не добавит соответствующие классы, которые мы используем для стилизации каждого элемента. Эти классы управляют общим внешним видом, а также отображением и скрытием с помощью переходов CSS. Вы можете изменить все это с помощью пользовательского CSS или переопределить наши переменные по умолчанию. Также стоит отметить, что практически любой HTML может быть в пределах .accordion-body, хотя переход ограничивает переполнение.</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div> -->



</div>
 


    
     <script>

        function delBlock() {
            if ($('#data_place').length) {
                $("#data_place").empty();
            }
        }

        function find_user() {
            var $form = $( '#form' ),
                url = $form.attr( "action" );
            var posting = $.post( url, {'data' : $('#q').val()} );

            posting.done(function( data ) {
                if (data.success == "false") {
                    toastr["warning"]("Пользователь не найден.", "Предупреждение!");
                }
                else {
                    outputData(data.patients[0]);
                    console.log(data.patients);
                    toastr["success"]("Успешно!");
                }
            });
        };

        function getTrustFactor(factor) {
          if (factor)
            return "Положительный"
          else
            return "Отрицательный"
        }

        function outputData(data) {
            delBlock()
            translate = {
              'default': 'Обычный',
              'child': 'Ребенок',
              'pregnant': 'Беременная'
            }
            $("<div/>").attr({id: 'data_place'}).appendTo('#main');
            $("<div/>").attr({id: 'card_main', class: 'card border-primary mb-3'}).appendTo('#data_place');
            $("<div/>").attr({id: 'card_header', class: 'card-header bg-transparent border-primary text-center'}).appendTo('#card_main');
            document.getElementById('card_header').textContent = data.full_name;
            $("<div/>").attr({id: 'card_body', class: 'card-body'}).appendTo('#card_main');
            $("<div/>").attr({id: 'card_body_row', class: 'row'}).appendTo('#card_body');
            $("<div/>").attr({id: 'card_body_col_1', class: 'col'}).appendTo('#card_body_row');
            $("<div/>").attr({id: 'card_body_col_2', class: 'col'}).appendTo('#card_body_row');
            $("<h3/>").attr({id: 'short_info', class: 'text-center lead'}).appendTo('#card_body_col_1');
            document.getElementById('short_info').textContent = 'Краткая информация';
            $("<ul/>").attr({id: 'card_header', class: 'list-group list-group-flush'}).appendTo('#card_body_col_1');
            $("<li/>").attr({id: 'card_text_type', class: 'list-group-item'}).appendTo('#card_body_col_1');
            document.getElementById('card_text_type').textContent = `Тип пациента "${translate[data.role]}"`;
            $("<li/>").attr({id: 'card_text_bd', class: 'list-group-item'}).appendTo('#card_body_col_1');
            document.getElementById('card_text_bd').textContent = `Дата рождения: ${data.birthday}`;
            $("<li/>").attr({id: 'card_text_age', class: 'list-group-item'}).appendTo('#card_body_col_1');
            document.getElementById('card_text_age').textContent = `Возраст: 0 лет`;
            $("<li/>").attr({id: 'card_text_tf', class: 'list-group-item'}).appendTo('#card_body_col_1');
            document.getElementById('card_text_tf').textContent = `Фактор доверия: ${getTrustFactor(data.trust_factor)}`;
            $("<li/>").attr({id: 'card_text_phone', class: 'list-group-item'}).appendTo('#card_body_col_1');
            document.getElementById('card_text_phone').textContent = `Номер телефона: ${data.phone}`;
            $("<li/>").attr({id: 'card_text_phone2', class: 'list-group-item'}).appendTo('#card_body_col_1');
            document.getElementById('card_text_phone2').textContent = `Дополнительный номер телефона: ${data.phone2}`;
            
            $("<h3/>").attr({id: 'data_info', class: 'text-center lead'}).appendTo('#card_body_col_2');
            if (data.role == 'default') {
                document.getElementById('data_info').textContent = 'Данные о пациенте';
                $("<ul/>").attr({id: 'card_header', class: 'list-group list-group-flush'}).appendTo('#card_body_col_2');
                $("<li/>").attr({id: 'card_text_lr_pass_serial', class: 'list-group-item'}).appendTo('#card_body_col_2');
                document.getElementById('card_text_lr_pass_serial').textContent = `Серия паспорта: ${data.lr_pass_serial}`;
                $("<li/>").attr({id: 'card_text_lr_pass_num', class: 'list-group-item'}).appendTo('#card_body_col_2');
                document.getElementById('card_text_lr_pass_num').textContent = `Номер паспорта: ${data.lr_pass_num}`;
                $("<li/>").attr({id: 'card_text_lr_pass_date', class: 'list-group-item'}).appendTo('#card_body_col_2');
                document.getElementById('card_text_lr_pass_date').textContent = `Дата выдачи: ${data.lr_pass_date}`;
                $("<li/>").attr({id: 'card_text_lr_pass_issued', class: 'list-group-item'}).appendTo('#card_body_col_2');
                document.getElementById('card_text_lr_pass_issued').textContent = `Кем выдан: ${data.lr_pass_issued}`;
            }
            else if (data.role == 'pregnant') {
                document.getElementById('data_info').textContent = 'Данные о пациенте';
                $("<ul/>").attr({id: 'card_header', class: 'list-group list-group-flush'}).appendTo('#card_body_col_2');
                $("<li/>").attr({id: 'card_text_lr_pass_serial', class: 'list-group-item'}).appendTo('#card_body_col_2');
                document.getElementById('card_text_lr_pass_serial').textContent = `Серия паспорта: ${data.lr_pass_serial}`;
                $("<li/>").attr({id: 'card_text_lr_pass_num', class: 'list-group-item'}).appendTo('#card_body_col_2');
                document.getElementById('card_text_lr_pass_num').textContent = `Номер паспорта: ${data.lr_pass_num}`;
                $("<li/>").attr({id: 'card_text_lr_pass_date', class: 'list-group-item'}).appendTo('#card_body_col_2');
                document.getElementById('card_text_lr_pass_date').textContent = `Дата выдачи: ${data.lr_pass_date}`;
                $("<li/>").attr({id: 'card_text_lr_pass_issued', class: 'list-group-item'}).appendTo('#card_body_col_2');
                document.getElementById('card_text_lr_pass_issued').textContent = `Кем выдан: ${data.lr_pass_issued}`;
                $("<li/>").attr({id: 'card_text_num_fetusd', class: 'list-group-item'}).appendTo('#card_body_col_2');
                document.getElementById('card_text_num_fetus').textContent = `Кол-во плодов: ${data.num_fetus}`;
            }
            else if (data.role == 'child') {
                document.getElementById('data_info').textContent = 'Данные о представители';
                $("<ul/>").attr({id: 'card_header', class: 'list-group list-group-flush'}).appendTo('#card_body_col_2');
                $("<li/>").attr({id: 'card_text_lr_pass_serial', class: 'list-group-item'}).appendTo('#card_body_col_2');
                document.getElementById('card_text_lr_pass_serial').textContent = `Серия паспорта: ${data.lr_pass_serial}`;
                $("<li/>").attr({id: 'card_text_lr_pass_num', class: 'list-group-item'}).appendTo('#card_body_col_2');
                document.getElementById('card_text_lr_pass_num').textContent = `Номер паспорта: ${data.lr_pass_num}`;
                $("<li/>").attr({id: 'card_text_lr_pass_date', class: 'list-group-item'}).appendTo('#card_body_col_2');
                document.getElementById('card_text_lr_pass_date').textContent = `Дата выдачи: ${data.lr_pass_date}`;
                $("<li/>").attr({id: 'card_text_lr_pass_issued', class: 'list-group-item'}).appendTo('#card_body_col_2');
                document.getElementById('card_text_lr_pass_issued').textContent = `Кем выдан: ${data.lr_pass_issued}`;
                $("<li/>").attr({id: 'card_text_lr_status', class: 'list-group-item'}).appendTo('#card_body_col_2');
                document.getElementById('card_text_lr_status').textContent = `Тип представителя "${translate[data.role]}"`;
                $("<li/>").attr({id: 'card_text_estimated_birthday', class: 'list-group-item'}).appendTo('#card_body_col_2');
                document.getElementById('card_text_estimated_birthday').textContent = `ПДР: ${data.estimated_birthday}`;
                $("<li/>").attr({id: 'card_text_lr_full_name', class: 'list-group-item'}).appendTo('#card_body_col_2');
                document.getElementById('card_text_lr_full_name').textContent = `ФИО: ${data.r_full_name}`;
            }
            $("<div/>").attr({id: 'card_footer', class: 'card-footer bg-transparent border-primary'}).appendTo('#card_main');
            $("<div/>").attr({id: 'row', class: 'row'}).appendTo('#card_footer');
            if (data.lost_records.length > 0 && data.future_records.length > 0) {
                if (data.lost_records.length > 0) {
                    $("<div/>").attr({id: 'col_1', class: 'col'}).appendTo('#row');
                    $("<label/>").attr({id: 'old_label', class: 'form-label', for: 'old_record'}).appendTo('#col_1');
                    $("<b/>").attr({id: 'b_old_label'}).appendTo('#old_label');
                    document.getElementById('b_old_label').textContent = 'Прошедшие записи';
                    $("<div/>").attr({id: 'old_record', class: 'accordion accordion-flush'}).appendTo('#col_1');
                    for (let i = 0; i < data.lost_records.length; i++) {
                        $("<div/>").attr({id: 'old_accordion_item' + i, class: 'accordion-item'}).appendTo('#old_record');
                        $("<h2/>").attr({id: 'old_accordion_item_header' + i, class: 'accordion-header'}).appendTo('#old_accordion_item' + i);
                        $("<button/>").attr({id: 'old_btn_' + i, class: 'accordion-button collapsed', type: 'button', 'data-bs-toggle': 'collapse', 'data-bs-target': '#old_text_' + i, 'aria-expanded': 'false', 'aria-controls': 'old_text_' + i}).appendTo('#old_accordion_item_header' + i);
                        document.getElementById('old_btn_' + i).textContent = `${data.lost_records[i].date} [${data.lost_records[i].time}]`;
                        $("<div/>").attr({id: 'old_text_' + i, class: 'accordion-collapse collapse'}).appendTo('#old_accordion_item' + i);
                        $("<div/>").attr({id: 'old_doctor_full_name_' + i, class: 'accordion-body'}).appendTo('#old_text_' + i);
                        document.getElementById('old_doctor_full_name_' + i).textContent = `Доктор: ${data.lost_records[i].doctor_full_name}`;
                        $("<div/>").attr({id: 'old_office_' + i, class: 'accordion-body'}).appendTo('#old_text_' + i);
                        document.getElementById('old_office_' + i).textContent = `Кабинет: ${data.lost_records[i].office}`;
                    }
                }
                if (data.future_records.length > 0) {
                    $("<div/>").attr({id: 'col_2', class: 'col'}).appendTo('#row');
                    $("<label/>").attr({id: 'future_label', class: 'form-label', for: 'future_record'}).appendTo('#col_2');
                    $("<b/>").attr({id: 'b_future_label'}).appendTo('#future_label');
                    document.getElementById('b_future_label').textContent = 'Текущие записи';
                    $("<div/>").attr({id: 'future_record', class: 'accordion accordion-flush'}).appendTo('#col_2');
                    for (let i = 0; i < data.future_records.length; i++) {
                        $("<div/>").attr({id: 'future_accordion_item' + i, class: 'accordion-item'}).appendTo('#future_record');
                        $("<h2/>").attr({id: 'future_accordion_item_header' + i, class: 'accordion-header'}).appendTo('#future_accordion_item' + i);
                        $("<button/>").attr({id: 'future_btn_' + i, class: 'accordion-button collapsed', type: 'button', 'data-bs-toggle': 'collapse', 'data-bs-target': '#future_text_' + i, 'aria-expanded': 'false', 'aria-controls': 'future_text_' + i}).appendTo('#future_accordion_item_header' + i);
                        document.getElementById('future_btn_' + i).textContent = `${data.future_records[i].date} [${data.future_records[i].time}]`;
                        $("<div/>").attr({id: 'future_text_' + i, class: 'accordion-collapse collapse'}).appendTo('#future_accordion_item' + i);
                        $("<div/>").attr({id: 'future_doctor_full_name_' + i, class: 'accordion-body'}).appendTo('#future_text_' + i);
                        document.getElementById('future_doctor_full_name_' + i).textContent = `Доктор: ${data.future_records[i].doctor_full_name}`;
                        $("<div/>").attr({id: 'future_office_' + i, class: 'accordion-body'}).appendTo('#future_text_' + i);
                        document.getElementById('future_office_' + i).textContent = `Кабинет: ${data.future_records[i].office}`;
                    }
                }
            }
            else {
                $("<h3/>").attr({id: 'footer_text', class: 'text-center lead'}).appendTo('#row');
                document.getElementById('footer_text').textContent = 'У данного пациента отсутствуют записи!';
            }
        }


        
    </script>

{% endblock %}


