{% extends 'base/base.html' %}


{% block content %}

<div class="container" id='cont'>
    <div class="row">
        <div class="col">
            <form id='searchFormtest' action="/reception/reception_process">
                <div id="sandbox-container" class="d-flex justify-content-center"></div>
            </form>
            <br>
            <div class role="alert" id="alert"></div>
        </div>
    </div>
    <!-- <div class="row" id='row_1'>
        <div class="col" id='col_1'>
            <div class="card" id='card_main'>
                <div class="card-body" id='card_body'>
                  <h5 class="card-title" id='card_title'>Card title</h5>
                  <p class="card-text" id='card_text'>Some quick example text to build on the card title and make up the bulk of the card's content.</p>
                </div>
                <ul class="list-group list-group-flush" id='card_list'>
                  <li class="list-group-item" id='card_list_item_1'>An item</li>
                  <li class="list-group-item">A second item</li>
                  <li class="list-group-item">A third item</li>
                </ul>
                <div class="card-body" id='card_footer'>
                  <a href="#" class="card-link" >Card link</a>
                  <a href="#" class="card-link">Another link</a>
                </div>
            </div>
        </div>
    </div> -->
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/js/bootstrap-datepicker.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/locales/bootstrap-datepicker.ru.min.js"></script>

<script>
    $(document).ready(function() { 
        get_doctors();
    });

    function get_doctors() {
        url = '/reception/get_doctors'
        var posting = $.post( url );

        posting.done(function( data ) {
            if (data.success == "false") {
                toastr["error"]("Произошла ошибка, пожалуйста попробуйте еще раз или обратитесь к администратору.", "Ошибка!");
            }
            else {
                // console.log(data.doctors);
                toastr["success"]("Успешно!");
                for (count in data.doctors) {
                    createForm(count, data.doctors[count])
                    console.log(data.doctors[count]);
                }
            }
        });
    };

    $('#sandbox-container').datepicker({
        format: "yyyy-mm-dd",
        startView: 2,
        maxViewMode: 2,
        todayBtn: "linked",
        language: "ru",
        daysOfWeekDisabled: "0",
        autoclose: true,
        todayHighlight: true,
    }).on('changeDate', showTestDate);
    function showTestDate() {
        console.log($('#sandbox-container').datepicker('getFormattedDate'));

        event.preventDefault();
    
        var $form = $( '#searchFormtest' ),
            term = $form.find( "#sandbosssx-container" ).val(),
            url = $form.attr( "action" );
    
        // Send the data using post
        var posting = $.post(url, { date: $('#sandbox-container').datepicker('getFormattedDate') } );
    
        // Put the results in a div
        posting.done(function( data ) {
            if (data.success == "false") {
                toastr["warning"]("Не найдены записи на сегодня.", "Предупреждение!");
            }
            else {
                for (var a = 0; a < data.data.length; a++) {
                    createForm(data);
                    console.log(data.data[a].full_name + a)
                    console.log(data.data[a].trust_factor + a)
                    console.log(data.data[a].role + a)
                    console.log(data.data[a].comment + a)
                    console.log(data.data[a].phone + a)

                }
            }
        });
    };

    function delBlock() {
        if ($('#data_place').length) {
            $("#data_place").empty();
        }
    }
    
    function createForm(count, data) {

    //     <div class="row" id='row_1'>
    //     <div class="col" id='col_1'>
    //         <div class="card" id='card_main'>
    //             <div class="card-body" id='card_body'>
    //               <h5 class="card-title" id='card_title'>Card title</h5>
    //               <p class="card-text" id='card_text'>Some quick example text to build on the card title and make up the bulk of the card's content.</p>
    //             </div>
    //             <ul class="list-group list-group-flush" id='card_list'>
    //               <li class="list-group-item" id='card_list_item_1'>An item</li>
    //               <li class="list-group-item">A second item</li>
    //               <li class="list-group-item">A third item</li>
    //             </ul>
    //             <div class="card-body" id='card_footer'>
    //               <a href="#" class="card-link" >Card link</a>
    //               <a href="#" class="card-link">Another link</a>
    //             </div>
    //         </div>
    //     </div>
    // </div>
        $("<div/>").attr({id: 'data_place'}).appendTo('#cont');
        $("<div/>").attr({id: `row_${count}`, class: 'row'}).appendTo('#data_place');
        $("<div/>").attr({id: `col_${count}`, class: 'col'}).appendTo(`#row_${count}`);
        $("<div/>").attr({id: `card_main_${count}`, class: 'card'}).appendTo(`#col_${count}`);
        $("<div/>").attr({id: `card_body_${count}`, class: 'card-body'}).appendTo(`#card_main_${count}`);
        $("<h5/>").attr({id: `card_title_${count}`, class: 'card-title'}).appendTo(`#card_body_${count}`);
        document.getElementById(`card_title_${count}`).textContent = data.doc_full_name;
        // $("<p/>").attr({id: `card_text_${count}`, class: 'card-text'}).appendTo(`#card_body_${count}`);
        // document.getElementById(`card_text_${count}`).textContent = 'Текст какой-то';
        $("<ul/>").attr({id: `card_list_${count}`, class: 'list-group list-group-flush'}).appendTo(`#card_main_${count}`);
        // for (record in data.records) {
        for (let a = 0; a < data.records.length; a++) {
            $("<li/>").attr({id: `card_list_item_${a}`, class: 'list-group-item'}).appendTo(`#card_list_${count}`);
            $("<input/>").attr({class: 'form-control', id: `card_list_item_input_${a}`, type: 'text'}).appendTo(`#card_list_item_${a}`);
        }
        // document.getElementById('card_list_item_1').textContent = `Строчка 1`;


        // $("<div/>").attr({id: 'card_body_row', class: 'row'}).appendTo('#card_body');
        // $("<div/>").attr({id: 'card_body_col_1', class: 'col'}).appendTo('#card_body_row');
        // $("<div/>").attr({id: 'card_body_col_2', class: 'col'}).appendTo('#card_body_row');
        // $("<h3/>").attr({id: 'short_info', class: 'text-center lead'}).appendTo('#card_body_col_1');
        // document.getElementById('short_info').textContent = 'Краткая информация';
        // $("<ul/>").attr({id: 'card_header', class: 'list-group list-group-flush'}).appendTo('#card_body_col_1');
        // $("<li/>").attr({id: 'card_text_type', class: 'list-group-item'}).appendTo('#card_body_col_1');
        // document.getElementById('card_text_type').textContent = `Тип пациента "${translate[data.role]}"`;
        // $("<li/>").attr({id: 'card_text_bd', class: 'list-group-item'}).appendTo('#card_body_col_1');
        // document.getElementById('card_text_bd').textContent = `Дата рождения: ${data.birthday}`;
        // $("<li/>").attr({id: 'card_text_age', class: 'list-group-item'}).appendTo('#card_body_col_1');
        // document.getElementById('card_text_age').textContent = `Возраст: ${data.age}`;
        // $("<li/>").attr({id: 'card_text_tf', class: 'list-group-item'}).appendTo('#card_body_col_1');
        // document.getElementById('card_text_tf').textContent = `Фактор доверия: ${getTrustFactor(data.trust_factor)}`;
        // $("<li/>").attr({id: 'card_text_phone', class: 'list-group-item'}).appendTo('#card_body_col_1');
        // document.getElementById('card_text_phone').textContent = `Номер телефона: ${data.phone}`;
        // $("<li/>").attr({id: 'card_text_phone2', class: 'list-group-item'}).appendTo('#card_body_col_1');
        // document.getElementById('card_text_phone2').textContent = `Дополнительный номер телефона: ${data.phone2}`;
        
        // $("<h3/>").attr({id: 'data_info', class: 'text-center lead'}).appendTo('#card_body_col_2');
    }
</script>

{% endblock %}

